---
title: VSCode Extension (1) 安装和运行
date: 2022-05-20
lastmod: 2023-03-03
type: blog
series:
- VSCode Extension
tags:
- VSCode Extension
description:
draft: false
cover:
    image: 
    caption: 
    alt: 
    relative: false
---

## 前言

上来先放VS Code插件开发的[官方文档](https://code.visualstudio.com/docs)，说实话非常详细，没必要再看其他教程。

该系列文章只是作为我学习的记录，也可在一些问题上给大家提供思路，有问题希望大家帮忙指正。

## 开发环境

系统：Windows 10
编辑器: VS Code

## 流程

### 安装Node.js

官网下载安装，设置安装到D盘，选择添加到Path。使用`node -v`和`npm -v`查看安装是否成功。

**问题**：尽管修改了Node.js的默认安装文件夹，但该文件夹依然需要管理员权限操作，此问题可能造成`npm install`时提示没有`mkdir`操作权限的问题。
**方法**：需要右键属性->安全->编辑->给Users所有权限。

因为不想占用c盘，修改npm默认安装路径。先在安装文件夹下创建两个新文件夹`node_cache`和`node_global`。运行命令修改npm设置：

```shell
npm config set prefix "D:/nodejs/node_global"
npm config set cache"D:/nodejs/node_cache"
```

运行这两行代码没有提示，运行结束可以使用`npm config ls`查看路径是否修改成功。还需要将`node_global`文件夹路径添加到环境变量的path中。

为了保持安装包的速度稳定，使用淘宝源，执行以下命令进行换源：

```shell
npm config set registry http://registry.npm.taobao.org/
```

### 使用yo创建项目

安装yo模块和generator-code模块来生成对应开发模板。

```shell
npm install -g yo generator-code
```

安装成功后可以使用yo模块生成对应的项目结构。

```shell
yo code
```

**问题**：VSCode中提示`yo : 无法加载文件 D:\nodejs\node_global\yo.ps1，因为在此系统上禁止运行脚本。`
**方法**：参考[博客](https://blog.csdn.net/zlq_CSDN/article/details/102789989)

- 以管理员身份启动终端
- 终端执行`get-ExecutionPolicy`查看权限为`Restricted`，表示为禁止
- 在终端执行 `set-ExecutionPolicy RemoteSigned`，显示`set-ExecutionPolicy : 对注册表项“HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\PowerShell\1\ShellIds\Microsoft.PowerShell”的访问被拒绝...`根据提示使用`Set-ExecutionPolicy Scope CurrentUser RemoteSigned`修改
- 再次执行`get-ExecutionPolicy`，显示为`RemoteSigned`

## 第一个extension

按照官方文档的步骤，先创建一个HelloWorld项目进行学习。

### 创建HelloWorld项目

使用`yo code`指令在当前目录创建，选择TypeScript语言，并输入extension名字为HelloWorld，是否使用git和webpack根据自己需求，我选的是No，包管理工具选择npm。

最后选择在VSCode中打开项目，创建的是模板项目，之后也在这个模板上学习修改。

### 运行HelloWorld项目

使用`F5`可以运行项目，弹出新的VSCode测试，使用快捷键`ctrl+shift+p`显示命令窗口，输入`Hello World`指令，能够看到右下角提示`Hello World from HelloWorld!`信息。

**运行后没有该命令**：可能是没有以该项目为根目录打开，整个项目没有运行起来。

该指令是模板写好的，我们可以通过修改代码体会代码结构。首先打开`extension.js`阅读，这里是具体实现。注释写的很清楚，仔细阅读也能懂个大概。

1. 通过修改`extension.ts`文件中`vscode.window.showInformationMessage();`里的字符串，从而修改提示信息内容。通过在测试窗口的命令行输入`Reload Window`指令重新加载查看效果。
2. 可以看到该函数是在`helloworld.helloWorld`命令中执行，注释也说了这一命令是在`package.json`中定义，并且所有使用的命令名都要先定义好。通过查看`package.json`，能发现定义。每条命令包括`command`和`title`，前者是代码内使用，后者是用户使用，通过修改测试我们也能体会对照关系。

### 调试

在代码行前面点标记，能够添加断点，运行后会停在断电，同时在原窗口会显示变量信息。还是比较简易的。

## 文件解析

拓展的模块主要由3部分组成：

- **Activation Events**: 触发插件的操作。
- **Contribution Points**: 在`package.json`文件中的模块声明。
- **VS Code API**: 模块在实现中的API。

最重要的设置文件就是`package.json`，其中`main`定义了入口文件。

入口文件有两个函数：

- `activate`: 当注册的 **Activation Event** 发生时执行。
- `deactivate`: 在插件关闭前执行，大多时候用不到。

## 总结

这里是 [Contribution Points](https://code.visualstudio.com/api/references/contribution-points) 和 [VS Code API](https://code.visualstudio.com/api/references/vscode-api)，现在，相信你已经完全掌握了VS Code 插件开发，理清你的需求，然后愉快地coding吧！

想要了解插件都能干什么，获得一些启发，可以和我一起继续学习[[b-vscode-extension-2]]。

[//begin]: # "Autogenerated link references for markdown compatibility"
[b-vscode-extension-2]: b-vscode-extension-2 "VS Code Extension (2) 插件能力"
[//end]: # "Autogenerated link references"